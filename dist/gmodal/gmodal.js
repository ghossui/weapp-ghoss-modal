import{CallType}from"./GhossModal.js";Component({properties:{data:{type:Object,observer:function(e,t){if(!0===e.show){const t=(getApp().gmodal||{}).config||{};e.theme||(e.theme=t.theme||"normal"),e.themeColor||(e.themeColor=t.themeColor||"#6495ED"),e.animation||(e.animation=t.animation||"none"),e.title||(e.title="标题"),e.content||(e.content=null),e.confirmText||(e.confirmText="确定"),e.cancelText||(e.cancelText="取消"),e.background||(e.background="#FFFFFF"),e.openType||(e.openType=null),e.appParameter||(e.appParameter=""),"boolean"!=typeof e.showInput&&(e.showInput=!1),e.showInput&&(e.value||(e.value=""),this.data.inputs["input-box"]=e.value,e.placeholder||(e.placeholder="请输入内容"),e.maxlength||(e.maxlength=140),e.inputType||(e.inputType="text"),"boolean"!=typeof e.lineBreaks&&(e.lineBreaks=!1),"boolean"!=typeof e.password&&(e.password=!1),"boolean"!=typeof e.focus&&(e.focus=!0),"boolean"!=typeof e.allowEmpty&&(e.allowEmpty=!0)),"boolean"!=typeof e.autoClose&&(e.autoClose=t.autoClose||!0),"boolean"!=typeof e.formId&&(e.formId=!1),"boolean"!=typeof e.maskClose&&(e.maskClose=t.maskClose||!1),"boolean"!=typeof e.showHeader&&(e.showHeader=!0),"boolean"!=typeof e.showFooter&&(e.showFooter=!0),"boolean"!=typeof e.showCancel&&(e.showCancel=!0),"boolean"!=typeof e.show&&(e.show=!1),null!==e.openType&&e.formId&&(e.formId=!1,console.warn("GhossModalException：当openType有值时不能设置formId为true，已自动设置为false")),"openSetting"===e.openType&&(e.openType=null,e.openSetting=!0),e.confirmStyle=`color: ${e.confirmColor?e.confirmColor:e.themeColor};`,e.cancelStyle=`color: ${e.cancelColor?e.cancelColor:"#333333"};`,e.inputStyle=`border-bottom-color:${e.themeColor};`,this.setData({o:e},()=>{this.show()})}else this.hide()}}},data:{inputs:{},detail:{},toggleClass:"",animationClass:"",hidden:!1,warning:{emptyValue:!1}},methods:{show(){this.setData({animationClass:this.data.o.animation+"-show",toggleClass:"gmodal-show",hidden:!0}),this.isTrigger=!1},hide(e){this.setData({animationClass:this.data.o.animation+"-hide",toggleClass:"gmodal-hide","o.show":!1}),setTimeout(()=>{this.setData({hidden:!1}),"function"==typeof e&&e(),this.data.inputs["input-box"]="",this.myTriggerEvent("close",{})},"none"===this.data.o.animation?0:350)},isTrigger:!1,bindConfirm(e){if(this.isTrigger)return;let t={};if(this.data.o.showInput){let e=(this.data.inputs["input-box"]||"").trim();if(!e&&!this.data.o.allowEmpty)return this.setData({"warning.emptyValue":!0}),void setTimeout(()=>{this.setData({"warning.emptyValue":!1})},300);t.value=e}"submit"===e.type&&(t.formId=e.detail.formId),this.data.o.autoClose&&this.hide(),this.data.o.openSetting?wx.openSetting({complete:e=>{t.openSetting="openSetting:ok"===e.errMsg,t.openSettingResult=e,this.triggerConfirm(t)}}):this.triggerConfirm(t)},bindCancel(e){if(this.isTrigger)return;let t=this.data.o.maskClose;e.currentTarget.dataset.mask&&!t||(this.hide(),this.triggerCancel())},bindInput(e){this.data.inputs[e.currentTarget.id]=e.detail.value,this.myTriggerEvent("input",e.detail)},triggerConfirm(e){this.myTriggerEvent("confirm",e)},triggerCancel(e){this.myTriggerEvent("cancel",e)},myTriggerEvent(e,t){(t=t instanceof Object?t:{}).autoClose=this.data.o.autoClose,this.triggerEvent("event-route",{detail:"close"===e?this.data.detail:t,eventType:e,confirmCaller:this.data.o.confirmCaller,inputCaller:this.data.o.inputCaller,cancelCaller:this.data.o.cancelCaller,completeCaller:this.data.o.completeCaller}),this.data.detail=this.cloneObject(t),!0===this.data.o.autoClose&&"input"!==e&&(this.isTrigger=!0)},cloneObject(e){let t=JSON.stringify(e);return JSON.parse(t)},noTouch(){},onErrorConfirmButton(e){console.error("自定义modal组件使用微信开放能力按钮的时候跑出了一个异常:\n",e)}}});