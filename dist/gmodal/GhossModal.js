function getEventRouter(e){return t=>{let{eventType:o,uk:n}=t.detail,l=o=>{if(o){let n=e.page[o];"function"==typeof n?n(t.detail.detail):throwRunntimeError(`未找到回调函数 "${o}()" 的定义。`)}},{confirmCaller:a,cancelCaller:r,inputCaller:c,completeCaller:i}=t.detail;"hide"===o?e.page.setData({[`${n}.show`]:!1}):"confirm"===o?l(a):"cancel"===o?l(r):"input"===o?l(c):"close"===o&&(t.detail.detail.callType=CallType.complete,l(i),delete e.page[a],delete e.page[r],delete e.page[c],delete e.page[i])}}function toggle(e,t,o,n=!1){return new Promise((l,a)=>{try{if(t)if(isPage(e.page)){if(o instanceof Object||(o={}),o.uk=t,o.show=n,!1===o.show)o={setData:o.setData};else{let t=t=>{let n=`onGhossModal${t}Event${(new Date).getTime()}`,a=t.toLowerCase(),r="function"==typeof o[a];"confirm"===a||"cancel"===a?e.page[n]=(e=>{e.callType=CallType[a],r&&o[a](e),l(e)}):r&&(e.page[n]=o[a]),r&&(o[`${a}Caller`]=n)};t("Confirm"),t("Cancel"),t("Input"),t("Complete")}let a=o.setData;delete o.setData,a instanceof Object||(a={}),a[t]=o,e.page.setData(a,o.setDataComplete)}else throwRunntimeError('"page" 参数异常，请检查是否已实例化成功，并且不要更改此参数');else throwRunntimeError('"name" 不能为空')}catch(e){a(e)}})}function showModal(e,t,o={},n){return new Promise((l,a)=>{try{"object"==typeof o?("object"==typeof n&&(o=n),n=o):"object"!=typeof n&&(n={}),void 0===o||"object"==typeof o?!0===n.showInput?n.title=t:(n.content=t,n.showHeader=!1):(n.title=t,n.content=o),n.autoClose=!0,n.maskClose=!1;const r=((getApp().gmodal||{}).config||{}).popup||{};n.theme=n.theme||r.theme,n.animation=n.animation||r.animation,n.confirm=(e=>{e.callType=CallType.confirm,l(e)}),n.cancel=(e=>{e.callType=CallType.cancel,l(e)}),e.show("gmodal.showModal",n)}catch(e){a(e)}})}function isPage(e){return e&&"object"==typeof e&&"function"==typeof e.setData}function throwInstantiatingError(e){throwError(e=`An error occurred while instantiating GhostModal: ${e}`)}function throwRunntimeError(e){throwError(e=`An error occurred while running GhostModal: ${e}`)}function throwError(e){console.group(`${new Date} GhossModal 错误`),console.error(e),console.groupEnd()}class GhossModal{constructor(e){isPage(e)?(this.page=e,this.page.onGhossModalEvent=getEventRouter(this)):(this.page=null,throwInstantiatingError("page 参数必须传入页面！"))}confirm(e,t,o){return showModal(this,e,t,o).then(e=>(e.confirm=e.callType===CallType.confirm,e.cancel=e.callType===CallType.cancel,Promise.resolve(e)),e=>Promise.reject(e))}prompt(e,t={}){return t.showInput=!0,showModal(this,e,null,t)}alert(e,t={},o){return"object"==typeof t&&(o=t,t=null),o.showCancel=!1,showModal(this,e,t,o)}show(e,t){return toggle(this,e,t,!0)}hide(e){return toggle(this,e,null,!1)}}const CallType={close:-1,complete:0,confirm:1,cancel:2,input:3};module.exports={GhossModal:GhossModal,CallType:CallType};