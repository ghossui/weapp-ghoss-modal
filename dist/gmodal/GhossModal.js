function getEventRouter(e){return t=>{let{eventType:o,uk:l}=t.detail,n=o=>{if(o){let l=e.page[o];"function"==typeof l?l(t.detail.detail):throwRunntimeError(`未找到回调函数 "${o}()" 的定义。`)}},{confirmCaller:a,cancelCaller:r,inputCaller:c,completeCaller:i}=t.detail;"hide"===o?e.page.setData({[`${l}.show`]:!1}):"confirm"===o?n(a):"cancel"===o?n(r):"input"===o?n(c):"close"===o&&(t.detail.detail.callType=CallType.complete,n(i),delete e.page[a],delete e.page[r],delete e.page[c],delete e.page[i])}}function toggle(e,t,o,l=!1){return new Promise((n,a)=>{try{if(t)if(isPage(e.page)){if(o instanceof Object||(o={}),o.uk=t,o.show=l,!1===o.show)o={setData:o.setData};else{let t=t=>{let l=`onGhossModal${t}Event${(new Date).getTime()}`,a=t.toLowerCase(),r="function"==typeof o[a];"confirm"===a||"cancel"===a?(e.page[l]=(e=>{e.callType=CallType[a],r&&o[a](e),n(e)}),o[`${a}Caller`]=l):r&&(e.page[l]=o[a],r&&(o[`${a}Caller`]=l))};t("Confirm"),t("Cancel"),t("Input"),t("Complete")}let a=o.setData;delete o.setData,a instanceof Object||(a={}),a[t]=o,e.page.setData(a,o.setDataComplete)}else throwRunntimeError('"page" 参数异常，请检查是否已实例化成功，并且不要更改此参数');else throwRunntimeError('"name" 不能为空')}catch(e){a(e)}})}function showModal(e,t,o={},l){return new Promise((n,a)=>{try{"object"==typeof o?("object"==typeof l&&(o=l),l=o):"object"!=typeof l&&(l={}),void 0===o||"object"==typeof o?!0===l.showInput?l.title=t:(l.content=t,l.showHeader=!1):(l.title=t,l.content=o),l.autoClose=!0,l.maskClose=!1;const r=((getApp().gmodal||{}).config||{}).popup||{};l.theme=l.theme||r.theme,l.animation=l.animation||r.animation,l.confirm=(e=>{e.callType=CallType.confirm,n(e)}),l.cancel=(e=>{e.callType=CallType.cancel,n(e)}),e.show("gmodal.showModal",l)}catch(e){a(e)}})}function isPage(e){return e&&"object"==typeof e&&"function"==typeof e.setData}function throwInstantiatingError(e){throwError(e=`An error occurred while instantiating GhostModal: ${e}`)}function throwRunntimeError(e){throwError(e=`An error occurred while running GhostModal: ${e}`)}function throwError(e){console.group(`${new Date} GhossModal 错误`),console.error(e),console.groupEnd()}class GhossModal{constructor(e){isPage(e)?(this.page=e,this.page.onGhossModalEvent=getEventRouter(this)):(this.page=null,throwInstantiatingError("page 参数必须传入页面！"))}confirm(e,t,o){return showModal(this,e,t,o).then(e=>(e.confirm=e.callType===CallType.confirm,e.cancel=e.callType===CallType.cancel,Promise.resolve(e)),e=>Promise.reject(e))}prompt(e,t={}){return t.showInput=!0,showModal(this,e,null,t)}alert(e,t={},o){return"object"==typeof t&&(o=t,t=null),o.showCancel=!1,showModal(this,e,t,o)}show(e,t){return toggle(this,e,t,!0)}hide(e){return toggle(this,e,null,!1)}}const CallType={close:-1,complete:0,confirm:1,cancel:2,input:3};module.exports={GhossModal:GhossModal,CallType:CallType};